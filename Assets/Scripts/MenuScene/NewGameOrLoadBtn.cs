// ------------------------------------------------------------------------------
//  <autogenerated>
//      This code was generated by a tool.
//      Mono Runtime Version: 4.0.30319.1
// 
//      Changes to this file may cause incorrect behavior and will be lost if 
//      the code is regenerated.
//  </autogenerated>
// ------------------------------------------------------------------------------
using System;
using UnityEngine;
using Utils;
using System.Collections.Generic;
using championship;
using PixelCrushers.DialogueSystem;


namespace MenuScene
{
	public class NewGameOrLoadBtn : MonoBehaviour
	{
		public UILabel gameLabel;
		public UIButton deleteButton;
		public UIButton gameButton;
		
		public int thisIndex;
		public NewGameMaker gameMaker;

		public NewGameOrLoadBtn ()
		{
		}
	
		public void onConfirmDelete() {
			
			if(SaveGameUtils.HasSavedGameAtIndex(thisIndex)) {
				ES2.Delete(SaveGameUtils.SAVED_GAME_NAME+thisIndex);
				OnEnable();
			}
		}
		public void OnEnable() {
			if(SaveGameUtils.HasSavedGameAtIndex(thisIndex)) {
				string headline = SaveGameUtils.headlineGameInfo(thisIndex);
				this.gameLabel.text = headline;
				this.deleteButton.gameObject.SetActive(true);
			} else {
				this.gameLabel.text = "New Game";
				this.deleteButton.gameObject.SetActive(false);
			}
		}
		public void onClicked() {
			
			SaveGameUtils.USING_INDEX = thisIndex;
			if(SaveGameUtils.HasSavedGameAtIndex(thisIndex)) {
				Debug.Log ("Load Game");
				List<string> l = ES2.LoadList<string>(SaveGameUtils.SAVED_GAME_NAME+thisIndex);
				
				ChampionshipSeason champ = GameObject.Find ("ChampionshipObject").GetComponent<ChampionshipSeason>();
				champ.FromString(l[(int) ESavedGameSetup.GameData]);
				champ.season = Convert.ToInt32(l[(int) ESavedGameSetup.SeasonsPast]);
				PersistentDataManager.ApplySaveData(l[(int) ESavedGameSetup.Lua]);
		//		ChampionshipSeason.ACTIVE_SEASON.secondsPast = Convert.ToInt32(l[(int) ESavedGameSetup.SeasonsPast]);
				ChampionshipSeason.ACTIVE_SEASON.initNextRace();
				ChampionshipSeason.ACTIVE_SEASON.leagueForTeam(ChampionshipSeason.ACTIVE_SEASON.getUsersTeam()).initNextRace();
				Application.LoadLevel("Garage");
			} else {
				Debug.Log ("New Game");
				MainMenuScene.REF.doGameMaker(thisIndex);
			}
		}
	}
} 

